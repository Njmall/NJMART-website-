<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NJ Mart — Fresh groceries, fast delivery</title>

  <!-- Fonts + icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Main styles (expanded, readable) -->
  <style>
    :root{
      --bg:#f6fbf8;
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#2db34a;
      --accent-dark:#1f8a34;
      --danger:#ef4444;
      --shadow: 0 10px 30px rgba(12,30,40,0.06);
      --max-width:1100px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#111;-webkit-font-smoothing:antialiased}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}

    /* container */
    .wrap{max-width:var(--max-width);margin:18px auto;padding:12px}

    /* Header */
    header.site-header{
      background:var(--card);
      border-radius:12px;
      box-shadow:var(--shadow);
      padding:10px 14px;
      display:flex;
      align-items:center;
      gap:12px;
      position:sticky;
      top:12px;
      z-index:50;
    }
    .brand{display:flex;align-items:center;gap:10px}
    .brand .logo{
      width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-dark));
      display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:18px;box-shadow:0 4px 12px rgba(16,185,129,0.12)
    }
    .brand h1{font-size:20px;margin:0}
    .search-box{flex:1;display:flex;align-items:center;gap:8px}
    .search-box input{
      width:100%;padding:10px 12px;border-radius:10px;border:1px solid #e9f0ec;background:#fff;font-size:15px;
    }
    .actions{display:flex;gap:8px;align-items:center}
    .btn{border:0;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff}
    .btn.ghost{background:#fff;border:1px solid #e6eef0}
    .cart-badge{background:#fff;border-radius:999px;padding:2px 8px;margin-left:6px;font-weight:700;color:#111}

    /* layout grid */
    .main-grid{display:grid;grid-template-columns:260px 1fr;gap:16px;margin-top:16px}
    @media(max-width:980px){
      .main-grid{grid-template-columns:1fr}
    }

    /* left sidebar */
    .sidebar{background:var(--card);padding:12px;border-radius:12px;box-shadow:var(--shadow)}
    .sidebar h3{margin:0 0 8px 0;font-size:16px}
    .category-list{display:flex;flex-direction:column;gap:8px}
    .category-item{padding:10px;border-radius:8px;cursor:pointer;border:1px dashed transparent}
    .category-item.active{background:#f3fff6;border:1px solid rgba(45,179,74,0.12)}
    .filter-group{margin-top:12px}

    /* main content area */
    .content-area{display:flex;flex-direction:column;gap:12px}
    .hero{background:linear-gradient(90deg,var(--accent),var(--accent-dark));color:white;padding:22px;border-radius:12px;display:flex;align-items:center;gap:18px}
    .hero .text h2{margin:0;font-size:22px}
    .hero .text p{margin:6px 0 0 0;opacity:0.95}
    .hero .cta{margin-top:8px}

    /* offers / banners */
    .offers{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .offer-card{background:linear-gradient(90deg,#fff,#f9fff4);padding:14px;border-radius:12px;box-shadow:0 6px 16px rgba(12,30,40,0.04);display:flex;gap:10px;align-items:center}

    /* product list */
    .product-topbar{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .product-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px;margin-top:12px}
    .product{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 18px rgba(12,30,40,0.04);display:flex;flex-direction:column;justify-content:space-between}
    .product .thumb{height:150px;background:#f4f7f6;border-radius:10px;overflow:hidden;margin-bottom:10px;display:flex;align-items:center;justify-content:center}
    .product .thumb img{width:100%;height:100%;object-fit:cover}
    .product h4{font-size:15px;margin:0 0 6px 0}
    .meta{font-size:13px;color:var(--muted);margin-bottom:8px}
    .product .price{font-weight:800;color:var(--accent);font-size:16px}
    .product .row{display:flex;justify-content:space-between;align-items:center;margin-top:10px;gap:8px}
    .product button{padding:8px 10px;border-radius:8px;border:0;cursor:pointer;font-weight:700}

    /* cart drawer */
    .cart-drawer{position:fixed;right:18px;bottom:18px;z-index:80}
    .cart-fab{background:var(--accent);color:#fff;padding:12px 16px;border-radius:14px;box-shadow:0 8px 30px rgba(16,185,129,0.18);cursor:pointer;display:flex;gap:8px;align-items:center}
    .cart-panel{position:fixed;right:18px;bottom:80px;width:360px;max-width:calc(100% - 32px);background:var(--card);border-radius:12px;box-shadow:var(--shadow);padding:12px;display:none}
    .cart-item{display:flex;gap:8px;align-items:center;padding:8px;border-bottom:1px solid #f1f3f4}
    .cart-item img{width:72px;height:64px;object-fit:cover;border-radius:8px}
    .cart-summary{padding:10px;border-top:1px solid #f1f3f4}

    /* testimonials & extras */
    .testimonials{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
    .testimonial{background:white;padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(12,30,40,0.04)}

    /* footer */
    footer.site-footer{margin-top:20px;background:var(--card);padding:16px;border-radius:12px;box-shadow:var(--shadow);display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap}
    footer .col{min-width:180px}

    /* small screens */
    @media(max-width:720px){
      header.site-header{flex-direction:column;gap:8px;align-items:stretch}
      .hero{flex-direction:column;align-items:flex-start}
      .main-grid{grid-template-columns:1fr}
      .cart-panel{right:12px;left:12px}
    }
    /* small helper classes */
    .muted{color:var(--muted)}
    .hidden{display:none}
    .small{font-size:13px}
    .center{display:flex;align-items:center;gap:8px}
  </style>

  <!-- include script-config helper (if you have it) -->
  <script src="./script-config.js"></script>
</head>
<body>

  <div class="wrap">

    <!-- HEADER -->
    <header class="site-header" role="banner">
      <div class="brand">
        <div class="logo">NJ</div>
        <div>
          <h1>NJ Mart</h1>
          <div class="muted" style="font-size:13px">Grocery & home delivery</div>
        </div>
      </div>

      <div class="search-box" role="search">
        <input id="globalSearch" type="search" placeholder="Search for products, brands, categories..." aria-label="Search products">
      </div>

      <div class="actions">
        <button id="btnAccount" class="btn ghost"><i class="fa fa-user"></i> <span id="accountLabel">Login</span></button>
        <button id="btnCart" class="btn">
          <i class="fa fa-shopping-cart"></i> Cart
          <span class="cart-badge" id="headerCartCount">0</span>
        </button>
      </div>
    </header>

    <!-- LAYOUT GRID: SIDEBAR + CONTENT -->
    <div class="main-grid" role="main">
      <!-- SIDEBAR -->
      <aside class="sidebar" aria-label="Filters">
        <h3>Categories</h3>
        <div class="category-list" id="categoryList">
          <!-- list filled by JS -->
        </div>

        <div class="filter-group">
          <h3>Filters</h3>
          <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
            <input id="minPrice" type="number" placeholder="Min ₹" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6eef0">
            <input id="maxPrice" type="number" placeholder="Max ₹" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6eef0">
          </div>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button id="applyFilters" class="btn primary">Apply</button>
            <button id="clearFilters" class="btn ghost">Clear</button>
          </div>
        </div>

        <div class="filter-group" style="margin-top:14px">
          <h3>Sort</h3>
          <select id="sortSelect" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6eef0">
            <option value="">Default</option>
            <option value="price_asc">Price low → high</option>
            <option value="price_desc">Price high → low</option>
          </select>
        </div>
      </aside>

      <!-- CONTENT AREA -->
      <section class="content-area">

        <!-- HERO -->
        <div class="hero" role="banner">
          <div style="flex:1" class="text">
            <h2>Fresh groceries delivered to your door</h2>
            <p>Shop from local favourites, daily essentials and fresh produce. Fast delivery & transparent pricing.</p>
            <div class="cta" style="margin-top:10px">
              <button id="shopNow" class="btn primary">Shop now</button>
              <button id="viewOffers" class="btn ghost">View offers</button>
            </div>
          </div>
          <div style="width:260px;text-align:center">
            <img src="https://via.placeholder.com/240x140?text=Fresh+Box" alt="Fresh box" style="border-radius:8px;box-shadow:0 6px 20px rgba(0,0,0,0.08)">
          </div>
        </div>

        <!-- OFFERS -->
        <div>
          <h3 style="margin:6px 0 8px 0">Special offers</h3>
          <div class="offers" id="offersArea">
            <div class="offer-card">
              <div style="flex:1">
                <div style="font-weight:800">Flat ₹50 off</div>
                <div class="muted" style="font-size:13px">On orders above ₹1000 — use code BIGSAVE</div>
              </div>
              <div style="font-weight:900;color:var(--accent);font-size:20px">SAVE50</div>
            </div>
            <div class="offer-card">
              <div style="flex:1">
                <div style="font-weight:800">Free Delivery</div>
                <div class="muted" style="font-size:13px">On orders above ₹499</div>
              </div>
              <div style="font-weight:900;color:var(--accent);font-size:20px">FREE499</div>
            </div>
            <div class="offer-card">
              <div style="flex:1">
                <div style="font-weight:800">Cashback</div>
                <div class="muted" style="font-size:13px">Get up to ₹30 cashback on UPI</div>
              </div>
              <div style="font-weight:900;color:var(--accent);font-size:20px">UPI30</div>
            </div>
          </div>
        </div>

        <!-- PRODUCTS TOP BAR -->
        <div class="product-topbar" style="margin-top:12px">
          <div>
            <h3 style="margin:0">Trending products</h3>
            <div class="muted" style="font-size:13px;margin-top:4px">Browse and add to cart — we deliver fast</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <input id="quickSearch" placeholder="Quick search within results" style="padding:8px;border-radius:8px;border:1px solid #e6eef0">
            <select id="perPage" style="padding:8px;border-radius:8px;border:1px solid #e6eef0">
              <option value="12">12 / page</option>
              <option value="24">24 / page</option>
              <option value="48">48 / page</option>
            </select>
          </div>
        </div>

        <!-- PRODUCT GRID -->
        <div id="productGrid" class="product-grid" aria-live="polite">
          <!-- filled by JS -->
          <div style="grid-column:1/-1;color:var(--muted);padding:30px;border-radius:10px;background:#fff">Loading products…</div>
        </div>

        <!-- PAGINATION (simple) -->
        <div style="display:flex;justify-content:center;margin-top:12px">
          <button id="prevPage" class="btn ghost">Prev</button>
          <div style="padding:8px 12px" id="pageInfo">Page 1</div>
          <button id="nextPage" class="btn ghost">Next</button>
        </div>

        <!-- TESTIMONIALS -->
        <div style="margin-top:18px">
          <h3>What customers say</h3>
          <div class="testimonials" id="testimonialsArea">
            <div class="testimonial">
              <div style="font-weight:700">Asha K.</div>
              <div class="muted" style="font-size:13px">"Fresh vegetables every time. Delivery is quick and helpful."</div>
            </div>
            <div class="testimonial">
              <div style="font-weight:700">Ravi P.</div>
              <div class="muted" style="font-size:13px">"Great prices and accurate billing. Highly recommended."</div>
            </div>
            <div class="testimonial">
              <div style="font-weight:700">Neha S.</div>
              <div class="muted" style="font-size:13px">"Easy to order, and the delivery boy called before arriving — love it!"</div>
            </div>
          </div>
        </div>

      </section>
    </div>

    <!-- CART FAB + PANEL -->
    <div class="cart-drawer" aria-live="polite">
      <div class="cart-fab" id="openCart">
        <i class="fa fa-shopping-basket"></i>
        <div>View cart</div>
        <div class="cart-badge" id="fabCount">0</div>
      </div>

      <div class="cart-panel" id="cartPanel" role="dialog" aria-label="Cart panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:800">Your cart</div>
          <button id="closeCart" class="btn ghost">Close</button>
        </div>

        <div id="cartItems" style="margin-top:10px;max-height:320px;overflow:auto">
          <!-- cart items injected here -->
          <div class="muted" style="padding:18px">Cart is empty</div>
        </div>

        <div class="cart-summary" style="margin-top:8px">
          <div style="display:flex;justify-content:space-between"><div class="muted">Subtotal</div><div id="cartSubtotal">₹0</div></div>
          <div style="display:flex;justify-content:space-between;margin-top:6px"><div class="muted">Delivery</div><div id="cartDelivery">₹25</div></div>
          <hr style="border:none;border-top:1px dashed #eee;margin:10px 0">
          <div style="display:flex;justify-content:space-between;font-weight:800"><div>Total</div><div id="cartTotal">₹0</div></div>
          <div style="margin-top:10px;display:flex;gap:8px">
            <button id="checkoutBtn" class="btn primary" style="flex:1">Checkout</button>
            <button id="clearCartBtn" class="btn ghost">Clear</button>
          </div>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <footer class="site-footer" role="contentinfo">
      <div class="col">
        <div style="font-weight:800;font-size:16px">NJ Mart</div>
        <div class="muted" style="margin-top:6px">Fresh groceries & household essentials with quick delivery.</div>
      </div>
      <div class="col">
        <div style="font-weight:700">Links</div>
        <div style="margin-top:6px" class="muted">
          <div><a href="index.html">Home</a></div>
          <div><a href="admin.html">Admin</a></div>
          <div><a href="contact.html">Contact</a></div>
        </div>
      </div>
      <div class="col">
        <div style="font-weight:700">Support</div>
        <div class="muted" style="margin-top:6px">Phone: <a href="tel:+917062918607" class="link">+91 70629 18607</a></div>
        <div class="muted">Email: support@njmart.example</div>
      </div>
    </footer>

  </div> <!-- wrap -->

  <!-- ========== SCRIPT: product load, cart logic, filters, pagination ========== -->
  <script>
  /*  Final index.js embedded
      - Uses global SCRIPT_URL if provided by script-config.js
      - Functions: loadProducts, renderProducts, addToCart, cart panel, filters, pagination
  */

  // ---------- Config & state ----------
  const DELIVERY_THRESHOLD = 499;
  const DELIVERY_CHARGE = 25;

  const API = (typeof SCRIPT_URL !== 'undefined') ? SCRIPT_URL : ''; // script-config.js should set SCRIPT_URL
  let PRODUCTS = [];        // full product list from backend
  let FILTERED = [];        // filtered subset
  let CATEGORIES = [];      // category list
  let currentPage = 1;
  let perPage = 12;

  // ---------- localStorage cart helpers ----------
  function loadCart(){
    try { return JSON.parse(localStorage.getItem('nj_cart')||'[]'); } catch(e){ return []; }
  }
  function saveCart(cart){ localStorage.setItem('nj_cart', JSON.stringify(cart)); }
  function clearCartLocal(){
    localStorage.removeItem('nj_cart');
    renderCart();
    updateCounts();
  }

  // update header & fab counts
  function updateCounts(){
    const cart = loadCart();
    const count = cart.reduce((s,i)=>s+i.qty,0);
    document.getElementById('headerCartCount').textContent = count;
    document.getElementById('fabCount').textContent = count;
  }

  // add item to cart (item = {id,name,price,image})
  function addToCartObj(item){
    const cart = loadCart();
    const idx = cart.findIndex(x=>x.id === item.id);
    if(idx > -1) cart[idx].qty += 1;
    else cart.push({ id: item.id, name: item.name, price: Number(item.price||0), qty: 1, image: item.image || '' });
    saveCart(cart);
    updateCounts();
    renderCart();
    showToast(item.name + ' added to cart');
  }

  // remove item from cart
  function removeFromCart(id){
    let cart = loadCart();
    cart = cart.filter(i=>i.id !== id);
    saveCart(cart);
    renderCart();
    updateCounts();
  }

  // change qty
  function changeQty(id, delta){
    const cart = loadCart();
    const idx = cart.findIndex(x=>x.id === id);
    if(idx>-1){
      cart[idx].qty = Math.max(1, cart[idx].qty + delta);
      saveCart(cart);
      renderCart();
      updateCounts();
    }
  }

  // calculate totals
  function calcTotals(){
    const cart = loadCart();
    const subtotal = cart.reduce((s,i)=>s + (Number(i.price||0) * Number(i.qty||1)), 0);
    const delivery = (subtotal === 0 || subtotal >= DELIVERY_THRESHOLD) ? 0 : DELIVERY_CHARGE;
    const total = subtotal + delivery;
    return { subtotal, delivery, total };
  }

  // render cart panel
  function renderCart(){
    const panel = document.getElementById('cartPanel');
    const container = document.getElementById('cartItems');
    const totals = calcTotals();
    container.innerHTML = '';
    const cart = loadCart();
    if(cart.length === 0){
      container.innerHTML = '<div class="muted" style="padding:18px">Your cart is empty</div>';
    } else {
      cart.forEach(i=>{
        const node = document.createElement('div');
        node.className = 'cart-item';
        node.innerHTML = `
          <img src="${i.image || 'https://via.placeholder.com/120'}" alt="">
          <div style="flex:1">
            <div style="font-weight:700">${i.name}</div>
            <div class="muted small" style="font-size:13px">₹${i.price} × ${i.qty} = ₹${(i.price * i.qty).toFixed(0)}</div>
            <div style="margin-top:8px;display:flex;gap:8px">
              <button class="btn ghost small" data-act="dec" data-id="${i.id}">−</button>
              <button class="btn ghost small" data-act="inc" data-id="${i.id}">+</button>
              <button class="btn ghost small" data-act="rm" data-id="${i.id}">Remove</button>
            </div>
          </div>
        `;
        container.appendChild(node);
      });
    }
    document.getElementById('cartSubtotal').textContent = '₹' + totals.subtotal.toFixed(0);
    document.getElementById('cartDelivery').textContent = '₹' + totals.delivery.toFixed(0);
    document.getElementById('cartTotal').textContent = '₹' + totals.total.toFixed(0);
  }

  // cart panel event delegation
  document.addEventListener('click', (e)=>{
    // delegation for cart item buttons
    const btn = e.target.closest('button[data-act]');
    if(btn && btn.dataset.id){
      const act = btn.dataset.act; const id = btn.datase
