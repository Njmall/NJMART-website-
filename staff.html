<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>NJ Mart â€” Staff Management</title>

  <!-- Fonts + Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root {
      --accent:#2db34a;
      --danger:#ef4444;
      --muted:#6b7280;
      --bg:#f9fbfa;
      --card:#ffffff;
      --shadow:0 6px 16px rgba(0,0,0,0.08);
      --max-width:1100px;
    }
    *{box-sizing:border-box}
    body {
      margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:#111;
    }
    a {text-decoration:none;color:inherit}
    .wrap {max-width:var(--max-width);margin:20px auto;padding:12px}

    /* Header */
    header.site-header {
      background:var(--card);
      border-radius:12px;
      box-shadow:var(--shadow);
      padding:10px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand {display:flex;align-items:center;gap:10px}
    .brand .logo {
      width:48px;height:48px;border-radius:10px;
      background:linear-gradient(135deg,var(--accent),#1f8a34);
      display:flex;align-items:center;justify-content:center;
      color:#fff;font-weight:800;font-size:18px;
    }
    .actions {display:flex;gap:8px}
    .btn {
      padding:8px 12px;
      border-radius:10px;
      border:0;
      font-weight:600;
      cursor:pointer;
    }
    .btn.primary {background:var(--accent);color:#fff}
    .btn.ghost {background:#fff;border:1px solid #ddd}
    .btn.danger {background:var(--danger);color:#fff}
    .cart-badge {
      background:#fff;
      padding:2px 6px;
      border-radius:999px;
      margin-left:4px;
      font-weight:700;
    }

    /* Staff Table */
    h2 {margin-top:20px;margin-bottom:10px}
    .card {
      background:var(--card);
      border-radius:12px;
      box-shadow:var(--shadow);
      padding:16px;
      margin-bottom:16px;
    }
    table {
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
    }
    table th, table td {
      padding:10px;
      text-align:left;
      border-bottom:1px solid #e6e9eb;
      font-size:14px;
    }
    table th {
      background:#f1f5f4;
    }
    .status-active {color:var(--accent);font-weight:700}
    .status-inactive {color:var(--danger);font-weight:700}
    .actions-cell button {margin-right:6px}

    /* Form */
    label {font-weight:600;font-size:14px}
    input, select {
      width:100%;padding:10px;
      border-radius:8px;border:1px solid #e4e9e7;
      margin-bottom:10px;
    }

    .toast {
      position:fixed;
      bottom:20px;
      left:50%;
      transform:translateX(-50%);
      background:#333;
      color:#fff;
      padding:10px 20px;
      border-radius:8px;
      display:none;
      z-index:100;
    }

    @media(max-width:800px){
      table th, table td {font-size:12px;padding:8px}
      .actions-cell button {margin-bottom:4px}
    }
  </style>

  <script src="./script-config.js"></script>
</head>
<body>
  <div class="wrap">

    <!-- HEADER -->
    <header class="site-header">
      <div class="brand">
        <div class="logo">NJ</div>
        <div>
          <strong>NJ Mart</strong>
          <div class="muted" style="font-size:13px">Staff Management</div>
        </div>
      </div>
      <div class="actions">
        <button onclick="location.href='index.html'" class="btn ghost"><i class="fa fa-home"></i></button>
        <button onclick="location.href='admin.html'" class="btn ghost"><i class="fa fa-cog"></i></button>
        <button onclick="location.href='cart.html'" class="btn primary">
          <i class="fa fa-shopping-cart"></i>
          <span class="cart-badge" id="cartCount">0</span>
        </button>
      </div>
    </header>

    <!-- STAFF LIST -->
    <h2>Staff List</h2>
    <div class="card">
      <table id="staffTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Phone</th>
            <th>Email</th>
            <th>Role</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="7" style="text-align:center;color:var(--muted)">Loading staff...</td></tr>
        </tbody>
      </table>
    </div>

    <!-- ADD STAFF -->
    <h2>Add / Edit Staff</h2>
    <div class="card">
      <form id="staffForm">
        <input type="hidden" id="staffId" />
        <label>Name</label>
        <input type="text" id="staffName" required />

        <label>Phone</label>
        <input type="tel" id="staffPhone" required />

        <label>Email</label>
        <input type="email" id="staffEmail" />

        <label>Role</label>
        <select id="staffRole">
          <option value="Manager">Manager</option>
          <option value="Delivery">Delivery</option>
          <option value="Support">Support</option>
        </select>

        <label>Status</label>
        <select id="staffStatus">
          <option value="active">Active</option>
          <option value="inactive">Inactive</option>
        </select>

        <div style="margin-top:10px;display:flex;gap:10px">
          <button type="submit" class="btn primary">Save Staff</button>
          <button type="reset" class="btn ghost">Clear</button>
        </div>
      </form>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    function showToast(msg){
      const t=document.getElementById("toast");
      t.textContent=msg;
      t.style.display="block";
      setTimeout(()=>{t.style.display="none"},2000);
    }

    async function loadStaff(){
      try{
        const res = await fetch(NJ_BACKEND_URL+"?action=staff");
        const data = await res.json();
        const tbody = document.querySelector("#staffTable tbody");
        tbody.innerHTML = "";
        if(data.ok && data.staff && data.staff.length>0){
          data.staff.forEach(st=>{
            const tr=document.createElement("tr");
            tr.innerHTML = `
              <td>${st.StaffID||""}</td>
              <td>${st.Name||""}</td>
              <td>${st.Phone||""}</td>
              <td>${st.Email||""}</td>
              <td>${st.Role||""}</td>
              <td class="${(st.Status||'').toLowerCase()==='active'?'status-active':'status-inactive'}">${st.Status||""}</td>
              <td class="actions-cell">
                <button class="btn ghost" onclick="editStaff('${st.StaffID}')">Edit</button>
                <button class="btn danger" onclick="deleteStaff('${st.StaffID}')">Delete</button>
              </td>
            `;
            tbody.appendChild(tr);
          });
        } else {
          tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;color:var(--muted)">No staff found</td></tr>';
        }
      }catch(e){
        console.error(e);
        showToast("Failed to load staff");
      }
    }

    async function saveStaff(e){
      e.preventDefault();
      const payload = {
        action:"addstaff",
        StaffID: document.getElementById("staffId").value,
        Name: document.getElementById("staffName").value,
        Phone: document.getElementById("staffPhone").value,
        Email: document.getElementById("staffEmail").value,
        Role: document.getElementById("staffRole").value,
        Status: document.getElementById("staffStatus").value
      };
      try{
        const res = await fetch(NJ_BACKEND_URL,{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify(payload)
        });
        const data = await res.json();
        if(data.ok){
          showToast("Staff saved!");
          document.getElementById("staffForm").reset();
          document.getElementById("staffId").value="";
          loadStaff();
        }else showToast("Error saving staff");
      }catch(err){
        console.error(err);
        showToast("Save failed");
      }
    }

    function editStaff(id){
      fetch(NJ_BACKEND_URL+"?action=staff").then(r=>r.json()).then(data=>{
        if(data.ok){
          const st = data.staff.find(s=>s.StaffID===id);
          if(st){
            document.getElementById("staffId").value=st.StaffID;
            document.getElementById("staffName").value=st.Name;
            document.getElementById("staffPhone").value=st.Phone;
            document.getElementById("staffEmail").value=st.Email;
            document.getElementById("staffRole").value=st.Role;
            document.getElementById("staffStatus").value=st.Status;
          }
        }
      });
    }

    async function deleteStaff(id){
      if(!confirm("Delete this staff?")) return;
      try{
        const res = await fetch(NJ_BACKEND_URL,{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({action:"deletestaff",StaffID:id})
        });
        const data = await res.json();
        if(data.ok){
          showToast("Staff deleted");
          loadStaff();
        } else showToast("Delete failed");
      }catch(e){
        console.error(e);
        showToast("Delete failed");
      }
    }

    document.getElementById("staffForm").addEventListener("submit",saveStaff);

    loadStaff();
  </script>
</body>
</html>
