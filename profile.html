<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NJ Mart — Profile</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--green:#2db34a;--muted:#8a8f98}
  *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,sans-serif}
  body{margin:0;background:#f2f6f8;color:#222}
  .page{max-width:820px;margin:18px auto;padding:14px}
  .card{background:#fff;border-radius:12px;padding:14px;box-shadow:0 8px 20px rgba(10,20,30,.05);margin-bottom:14px}
  header{display:flex;align-items:center;gap:12px}
  header h1{margin:0;font-size:20px}
  label{display:block;margin:8px 0 6px 0;color:#444;font-weight:600}
  input,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ed;background:#fff}
  .btn{display:inline-block;padding:10px 16px;border-radius:8px;background:var(--green);color:#fff;border:0;cursor:pointer;font-weight:700}
  .danger{background:#e04d4d}
  .muted{color:var(--muted)}
  .flex{display:flex;gap:12px;align-items:center}
  .row{display:flex;gap:12px}
  @media(max-width:700px){ .row{flex-direction:column} }
</style>
</head>
<body>
<div class="page">
  <header>
    <button onclick="location.href='index.html'" style="border:0;background:#fff;padding:8px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.04);cursor:pointer">←</button>
    <h1>My Profile</h1>
  </header>

  <div class="card">
    <div id="signedInfo" style="margin-bottom:12px"></div>

    <label for="name">Name</label>
    <input id="name" placeholder="Full name">

    <label for="phone">Phone (with country code)</label>
    <input id="phone" placeholder="+91 9876543210">

    <label for="address">Address</label>
    <textarea id="address" rows="3" placeholder="Your address"></textarea>

    <div style="margin-top:12px" class="flex">
      <button id="saveBtn" class="btn">Save Profile</button>
      <button id="getLocBtn" style="padding:10px 14px;border-radius:8px;background:#fff;border:1px solid #e6e9ed;cursor:pointer">Get current location</button>
      <button id="signOutBtn" class="btn danger" style="margin-left:auto">Sign out</button>
    </div>

    <div style="margin-top:12px" class="muted">Profile is saved locally in your browser (localStorage). Use login flow to link with real backend.</div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px 0">Account</h3>
    <div id="extraInfo" class="muted"></div>
    <div style="margin-top:12px" class="row">
      <button onclick="location.href='orders.html'" class="btn" style="background:#2b7bff">My Orders</button>
      <button onclick="location.href='cart.html'" class="btn" style="background:#444">View Cart</button>
    </div>
  </div>
</div>

<script>
/*
profile.html
- manages local user profile stored at localStorage key 'nj_user'
- sign out clears 'nj_user' and returns to index
*/

const USER_KEY = 'nj_user';

function getUser(){
  try{ const r = localStorage.getItem(USER_KEY); return r ? JSON.parse(r) : null; }catch(e){ return null; }
}
function saveUser(u){ localStorage.setItem(USER_KEY, JSON.stringify(u)); }

function render(){
  const u = getUser();
  const info = document.getElementById('signedInfo');
  if(u){
    info.innerHTML = `<div style="font-weight:700">Signed in as: ${u.email || u.name || 'User'}</div><div class="muted">Last updated: ${new Date((u.updatedAt||u.createdAt||0)).toLocaleString()}</div>`;
    document.getElementById('name').value = u.name || '';
    document.getElementById('phone').value = u.phone || '';
    document.getElementById('address').value = u.address || '';
    document.getElementById('extraInfo').textContent = 'You are signed in. Use Save Profile to persist details.';
  } else {
    info.innerHTML = `<div style="font-weight:700">Not signed in</div><div class="muted">Use Sign in option on login page to sign in with Google or Phone (demo).</div>`;
    document.getElementById('name').value = '';
    document.getElementById('phone').value = '';
    document.getElementById('address').value = '';
    document.getElementById('extraInfo').textContent = 'Sign in first (login.html) or save profile locally.';
  }
}

document.getElementById('saveBtn').addEventListener('click', ()=>{
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const address = document.getElementById('address').value.trim();
  if(!name || !phone){ alert('Please enter name and phone'); return; }
  const prev = getUser() || {};
  const u = {...prev, name, phone, address, updatedAt: Date.now(), createdAt: prev.createdAt || Date.now()};
  saveUser(u);
  alert('Profile saved locally');
  render();
});

document.getElementById('signOutBtn').addEventListener('click', ()=>{
  if(!confirm('Sign out? This will clear local profile.')) return;
  localStorage.removeItem(USER_KEY);
  alert('Signed out');
  render();
});

document.getElementById('getLocBtn').addEventListener('click', ()=>{
  if(!navigator.geolocation){ alert('Geolocation not supported'); return; }
  document.getElementById('getLocBtn').textContent = 'Locating...';
  navigator.geolocation.getCurrentPosition(pos=>{
    document.getElementById('getLocBtn').textContent = 'Get current location';
    const lat = pos.coords.latitude.toFixed(6), lon = pos.coords.longitude.toFixed(6);
    const addr = document.getElementById('address');
    addr.value = (addr.value ? addr.value + '\n' : '') + `Current location: ${lat}, ${lon}`;
  }, err=>{
    document.getElementById('getLocBtn').textContent = 'Get current location';
    alert('Unable to get location: ' + (err.message||err.code));
  }, {timeout:10000});
});

render();
</script>
</body>
</html>
