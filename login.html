<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NJ Mart — Admin Login</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    /* ========== Base ========== */
    :root{
      --bg: #f1f8e9;
      --card: #fff;
      --accent: #2e7d32;
      --accent-2: #43a047;
      --muted: #7a7a7a;
      --glass: rgba(255,255,255,0.85);
      --radius: 16px;
      --shadow: 0 10px 30px rgba(17,17,17,0.08);
      --green-soft: #e8f5e9;
    }
    * { box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
    html,body{ height:100%; margin:0; background: linear-gradient(180deg,#ecf6e9 0%, #f7fff7 100%); color:#111; }

    /* ========== Layout ========== */
    .page {
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:40px;
      padding:40px;
    }

    .card {
      width: 980px;
      max-width: calc(100% - 48px);
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: grid;
      grid-template-columns: 420px 1fr;
      overflow: hidden;
      align-items: stretch;
    }

    /* Left: brand + illustration */
    .panel-left{
      background: linear-gradient(180deg, rgba(66,165,90,0.06), rgba(76,175,80,0.02));
      padding: 32px;
      display:flex;
      flex-direction: column;
      gap:18px;
      align-items: center;
      justify-content: center;
    }

    .brand {
      display:flex;
      gap:14px;
      align-items:center;
      width:100%;
      justify-content:center;
    }

    /* Logo box */
    .logo-box{
      width:86px;
      height:86px;
      border-radius:20px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(135deg,#e8f5e9, #ffffff);
      box-shadow: 0 6px 18px rgba(67,160,71,0.08);
      border:1px solid rgba(66,165,90,0.06);
    }

    .brand h1{
      color: var(--accent);
      font-size:24px;
      font-weight:800;
      letter-spacing:0.6px;
      margin:0;
    }
    .tagline{ color:var(--accent-2); font-size:13px; font-weight:600; margin-top:6px; }

    .left-desc {
      width:100%;
      text-align:center;
      color:var(--muted);
      font-size:14px;
      line-height:1.45;
      padding: 12px 16px;
    }

    .left-hero {
      width:100%;
      display:flex;
      justify-content:center;
      margin-top:6px;
    }

    /* right — login form */
    .panel-right{
      padding: 32px 36px;
    }

    .welcome {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom:14px;
    }
    .welcome h2 { font-size:20px; margin:0; color:#123; }
    .welcome p { margin:0; color:var(--muted); font-size:13px; }

    /* Controls */
    .actions { display:flex; gap:12px; margin-top:14px; }
    .btn {
      display:inline-flex; align-items:center; gap:10px;
      padding:12px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:700;
      transition: transform .12s ease, box-shadow .12s ease;
      font-size:15px;
    }
    .btn:active{ transform: translateY(1px); }

    .btn-google {
      background: #fff;
      border:1px solid #e0e0e0;
      color:#333;
      box-shadow: 0 4px 10px rgba(0,0,0,0.03);
      min-width:230px;
      justify-content:center;
    }
    .btn-phone {
      background: linear-gradient(90deg,var(--accent),var(--accent-2));
      color:#fff;
      min-width:230px;
      justify-content:center;
    }

    /* support area */
    .support {
      margin-top:18px;
      color:var(--muted);
      font-size:13px;
    }
    .support strong { color: #222; display:block; margin-top:6px; font-weight:700; }

    /* status box */
    .status {
      margin-top:16px;
      padding:12px 14px;
      border-radius:10px;
      background: #fff8e1;
      border:1px solid rgba(244, 176, 77, 0.12);
      color:#a65;
      font-size:13px;
    }

    /* small foot */
    .foot {
      margin-top:20px;
      font-size:12px; color:var(--muted);
      display:flex; justify-content:space-between; align-items:center;
    }

    /* responsive */
    @media (max-width:900px){
      .card { grid-template-columns: 1fr; width: 96%; }
      .panel-left{ padding:24px; }
      .panel-right{ padding:20px; }
      .btn { min-width:unset; width:100%; }
      .actions{ flex-direction:column; }
    }

    /* little micro animations */
    .fade-in { animation: fadeIn .5s ease both; }
    @keyframes fadeIn { from{opacity:0; transform:translateY(6px);} to{opacity:1; transform:none;} }

    /* input style for any optional fields we might show */
    .field { margin-top:10px; display:flex; flex-direction:column; gap:6px; }
    .field input {
      padding:10px 12px; border-radius:8px; border:1px solid #e6e6e6; outline:none;
      font-size:14px;
    }
    .field input:focus{ border-color: #c8e6c9; box-shadow: 0 4px 12px rgba(67,160,71,0.06); }

    /* nice toast */
    .toast {
      position: fixed;
      right: 20px;
      bottom: 20px;
      background: #121212;
      color: #fff;
      padding: 12px 16px;
      border-radius: 10px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.2);
      opacity: 0;
      transform: translateY(12px);
      transition: all .24s ease;
      z-index: 9999;
    }
    .toast.show { opacity:1; transform:none; }
  </style>
</head>

<body>
  <div class="page">
    <div class="card fade-in" role="main" aria-labelledby="nj-title">
      <!-- LEFT -->
      <div class="panel-left" aria-hidden="false">
        <div class="brand">
          <div class="logo-box" aria-hidden="true">
            <!-- Basket + delivery truck icon (SVG) -->
            <svg width="56" height="56" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <rect x="1.5" y="6" width="15" height="10" rx="1.2" stroke="#43a047" stroke-width="1.4" fill="#e8f5e9"></rect>
              <path d="M17 8h4v6h-4" stroke="#2e7d32" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path>
              <circle cx="6.5" cy="17" r="1.7" fill="#2e7d32"></circle>
              <circle cx="18" cy="17" r="1.7" fill="#2e7d32"></circle>
              <path d="M3 6l2-3 3 3" stroke="#388e3c" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
          </div>

          <div style="text-align:left;">
            <h1 id="nj-title">NJ Mart</h1>
            <div class="tagline">Fresh Grocery • Fast Delivery</div>
          </div>
        </div>

        <div class="left-desc">
          Admin panel login for your store. Use <strong>Google</strong> or <strong>Phone (OTP)</strong> — secure and fast. Make sure authorized domains and Firebase Auth providers are enabled.
        </div>

        <div class="left-hero" aria-hidden="true">
          <!-- decorative illustration -->
          <svg width="220" height="140" viewBox="0 0 220 140" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="0" y="0" width="220" height="140" rx="14" fill="#ffffff" opacity="0.5"/>
            <g transform="translate(12,8)">
              <rect x="0" y="0" width="72" height="72" rx="12" fill="#e8f5e9" />
              <rect x="84" y="0" width="120" height="32" rx="8" fill="#fff" stroke="#e6f2e8" />
              <rect x="84" y="44" width="85" height="44" rx="8" fill="#fff" stroke="#e6f2e8" />
            </g>
          </svg>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="panel-right">
        <div class="welcome">
          <div>
            <h2>Admin sign in</h2>
            <p>Choose Google or Phone (OTP) to continue — fast and secure</p>
          </div>
        </div>

        <!-- status box will show API / recaptcha messages -->
        <div id="statusBox" class="status" style="display:none;"></div>

        <!-- Buttons -->
        <div class="actions">
          <button class="btn btn-google" id="btnGoogle" title="Sign in with Google">
            <svg width="18" height="18" viewBox="0 0 533.5 544.3" style="margin-right:8px;">
              <!-- small google icon simplified -->
              <path fill="#4285F4" d="M533.5 278.4c0-18.2-1.5-35.7-4.3-52.7H272v99.8h147.3c-6.3 34-25.6 62.8-54.7 82.1v68h88.5c51.7-47.6 81.4-118 81.4-197.2z"></path>
              <path fill="#34A853" d="M272 544.3c73.5 0 135.2-24.2 180.3-65.7l-88.5-68c-24.6 16.6-56 26.6-91.8 26.6-70.6 0-130.4-47.6-151.9-111.4H28.8v69.8C73.9 486 167.6 544.3 272 544.3z"></path>
              <path fill="#FBBC05" d="M120.1 323.6c-8.6-25.2-8.6-52.5 0-77.7V176.1H28.8c-30.7 60.1-30.7 131 0 191.1L120.1 323.6z"></path>
              <path fill="#EA4335" d="M272 109.2c39.9 0 75.8 13.7 104 40.6l78-78C405.6 24.1 343.9 0 272 0 167.6 0 73.9 58.3 28.8 147.1l91.3 69.8C141.6 156.8 201.4 109.2 272 109.2z"></path>
            </svg>
            Sign in with Google
          </button>

          <button class="btn btn-phone" id="btnPhone" title="Sign in with Phone">
            <svg width="18" height="18" viewBox="0 0 24 24" style="margin-right:8px; filter:brightness(1.04) contrast(1.02)">
              <path fill="#fff" d="M6.6 10.8c1.6 3.1 4 5.4 7.1 7.1l2-2c.3-.3.8-.4 1.1-.2 1.2.7 2.6 1.1 4 1.1.5 0 .9.4.9.9V21c0 .5-.4.9-.9.9C9.4 22 2 14.6 2 5.9 2 5.4 2.4 5 2.9 5H6c.5 0 .9.4.9.9 0 1.4.4 2.8 1.1 4 .2.3.1.8-.2 1.1l-2 2z"/>
            </svg>
            Sign in with Phone (OTP)
          </button>
        </div>

        <!-- reCAPTCHA placeholder (firebase uses this) -->
        <div id="recaptcha-container" style="margin-top:18px;"></div>

        <!-- optional phone field fallback (hidden by default) -->
        <div id="phoneBlock" style="display:none; margin-top:12px;">
          <div class="field">
            <label style="font-size:13px;color:var(--muted)">Phone number</label>
            <input id="phoneInput" placeholder="+91 98765 43210" />
          </div>
        </div>
        
        <div class="support">
          Support: <strong>📞 +91 7062918607</strong><br>
          Email: <strong>nitin14142000@gmail.com</strong>
        </div>

        <div class="foot">
          <div style="font-size:12px;color:var(--muted)">NJ Mart Admin • Secure Authentication</div>
          <div style="font-size:12px;color:var(--muted)">© NJ Mart</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Firebase Compat SDKs -->
  <!-- Using compat versions to match your current setup; if you migrate to modular SDK, change accordingly -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

  <script>
    /*************************************************************
     * FINAL EXPANDED LOGIN.HTML — Single File
     * - Google sign-in + Phone OTP
     * - reCAPTCHA handling + robust errors
     * - UI toast + status messages
     *
     * NOTE:
     * 1) Make sure your Firebase Console:
     *    - Auth -> Sign-in methods: Google (enabled), Phone (enabled)
     *    - Authorized domains: add your deployed domain (e.g. njmart.netlify.app) and localhost
     * 2) API key restrictions (Google Cloud): if you restrict HTTP referrers,
     *    add both https://njmart.netlify.app and https://njmartonline.firebaseapp.com and http://localhost:3000
     *************************************************************/

    // ---------- Utility UI helpers ----------
    const toastEl = document.getElementById('toast');
    function showToast(msg, ms = 3500) {
      toastEl.textContent = msg;
      toastEl.classList.add('show');
      clearTimeout(toastEl._t);
      toastEl._t = setTimeout(()=> toastEl.classList.remove('show'), ms);
    }
    function setStatus(message, visible = true, type='info') {
      const box = document.getElementById('statusBox');
      if(!visible){ box.style.display = 'none'; return; }
      box.style.display = 'block';
      box.style.background = type === 'error' ? '#ffe6e6' : (type === 'warn' ? '#fff8e1' : '#fff');
      box.style.borderColor = type === 'error' ? 'rgba(255,0,0,0.06)' : 'rgba(200,200,200,0.06)';
      box.textContent = message;
    }

    // ---------- Firebase config (from your screenshot) ----------
    const firebaseConfig = {
      apiKey: "AIzaSyCaZDKEo-yY5iSYR_yBuAuSC1LMsnuCeAA",
      authDomain: "njmartonline.firebaseapp.com",
      projectId: "njmartonline",
      storageBucket: "njmartonline.appspot.com",
      messagingSenderId: "594505763627",
      appId: "1:594505763627:web:a13bd3ef40e620f9b936e"
    };

    // Initialize Firebase
    try{
      firebase.initializeApp(firebaseConfig);
    }catch(e){
      console.error("Firebase initialization error:", e);
      setStatus("Firebase init failed. Check your config in the Firebase console.", true, 'error');
    }
    const auth = firebase.auth();

    // quick check: authorized domains / recaptcha note
    setStatus('Initializing authentication...');

    // ---------- reCAPTCHA setup helper ----------
    // Using invisible reCAPTCHA for phone flows
    let recaptchaVerifier = null;
    function ensureRecaptcha() {
      if (recaptchaVerifier) return recaptchaVerifier;
      try {
        recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
          size: 'invisible',
          callback: (token) => {
            // on successful recaptcha token
            console.debug('reCAPTCHA token:', token);
          },
          'expired-callback': () => {
            showToast('reCAPTCHA expired. Please try again.');
          }
        });
        recaptchaVerifier.render().then(widgetId => {
          console.log('reCAPTCHA rendered widgetId=', widgetId);
        });
      } catch(err) {
        console.error('reCAPTCHA initialization error:', err);
        setStatus('reCAPTCHA failed to initialize. Check network & authorized domains.', true, 'error');
      }
      return recaptchaVerifier;
    }

    // ---------- Google Login ----------
    document.getElementById('btnGoogle').addEventListener('click', async function(){
      setStatus('Opening Google sign-in...');
      try {
        const provider = new firebase.auth.GoogleAuthProvider();
        // Optional: request additional scopes here if needed: provider.addScope('profile');
        const result = await auth.signInWithPopup(provider);
        console.log('Google sign-in result:', result);
        setStatus('Signed in as ' + (result.user?.displayName || result.user?.email), true, 'info');
        showToast('Google sign-in successful!');
      } catch (err) {
        console.error('Google sign-in error:', err);
        // Better error message guidance for common issues:
        if(err && err.code === 'auth/network-request-failed'){
          setStatus('Network error. Please check your internet.', true, 'error');
        } else if(err && err.code === 'auth/popup-closed-by-user'){
          setStatus('Sign-in popup closed. Try again.', true, 'warn');
        } else if(err && err.code === 'auth/operation-not-allowed'){
          setStatus('Google sign-in not enabled in Firebase Auth. Enable it in Console.', true, 'error');
        } else if(err && err.code === 'auth/invalid-api-key'){
          setStatus('Invalid API key. Check your Firebase config and Google Cloud API key restrictions.', true, 'error');
        } else if(err && err.code === 'auth/unauthorized-domain') {
          setStatus('Unauthorized domain. Add the current domain to Firebase Auth authorized domains.', true, 'error');
        } else {
          setStatus('Google sign-in failed: ' + (err && err.message ? err.message : 'unknown'), true, 'error');
        }
        showToast('Google sign-in failed. See console for details.');
      }
    });

    // ---------- Phone login (OTP) ----------
    document.getElementById('btnPhone').addEventListener('click', async function(){
      // show a friendly prompt: ask phone number
      const phone = prompt("Enter phone number with country code (e.g. +919876543210):");
      if(!phone) { setStatus('Phone login cancelled', true, 'warn'); return; }

      // initialize recaptcha
      setStatus('Preparing reCAPTCHA...');
      ensureRecaptcha();

      try {
        const appVerifier = recaptchaVerifier;
        setStatus('Sending OTP to ' + phone + ' ...');
        const confirmationResult = await auth.signInWithPhoneNumber(phone, appVerifier);
        // Ask user for code
        const code = prompt('Enter the 6-digit OTP you received:');
        if(!code) { setStatus('OTP entry cancelled', true, 'warn'); return; }
        const userCredential = await confirmationResult.confirm(code);
        console.log('Phone sign-in success', userCredential);
        setStatus('Phone sign-in successful: ' + (userCredential.user.phoneNumber || 'unknown'), true, 'info');
        showToast('Phone sign-in success!');
      } catch(err) {
        console.error('Phone sign-in error:', err);
        if(err && err.code === 'auth/invalid-phone-number') setStatus('Invalid phone number format.', true, 'error');
        else if(err && err.code === 'auth/invalid-verification-code') setStatus('Invalid OTP entered.', true, 'error');
        else if(err && err.code === 'auth/quota-exceeded') setStatus('SMS quota exceeded for this project — enable billing or wait.', true, 'error');
        else if(err && err.code === 'auth/missing-app-credential') setStatus('Missing app credential (reCAPTCHA) — ensure recaptcha is rendered.', true, 'error');
        else if(err && err.code === 'auth/network-request-failed') setStatus('Network error; check your connection.', true, 'error');
        else setStatus('Phone sign-in failed: ' + (err && err.message ? err.message : 'unknown'), true, 'error');
        showToast('Phone sign-in failed. See console for details.');
      }
    });
   
    // ---------- Auth state change ----------
    auth.onAuthStateChanged(user => {
      if(user){
        console.log('User signed in:', user);
        setStatus('Signed in as ' + (user.displayName || user.phoneNumber || user.email), true, 'info');
        showToast('Welcome back!');
        // Optionally: redirect to admin dashboard
        // window.location.href = '/admin-dashboard.html';
      }else{
        console.log('No user logged in');
        setStatus('No user logged in. Use Google or Phone to sign in.', true, 'info');
      }
    });

    // ---------- Helpful debug checks to show to user ----------
    (function runInitialChecks(){
      // 1) Check firebase config values presence
      const missing = [];
      for(const k of ['apiKey','authDomain','projectId','appId']){
        if(!firebaseConfig[k]) missing.push(k);
      }
      if(missing.length){
        setStatus('Firebase config missing: ' + missing.join(', '), true, 'error');
        console.warn('Missing firebase config keys:', missing);
      } else {
        setStatus('Firebase initialized for NJ Mart. Use Google / Phone to login.');
      }

      // 2) Quick note for dev: Detect running origin mismatch & give guidance
      const origin = window.location.origin;
      const allowed = [
        'http://localhost:3000',
        'http://localhost:4200',
        'https://njmart.netlify.app',
        'https://njmartonline.firebaseapp.com'
      ];
      if(!allowed.includes(origin)){
        console.log('Current origin not in typical list — make sure this origin is added to Firebase Auth authorized domains.');
        // Show brief hint but not block
        setTimeout(()=> {
          setStatus('Note: Ensure this origin is listed in Firebase Auth -> Authorized domains if login fails: ' + origin, true, 'warn');
        }, 1400);
      }

      // 3) If API key restrictions may cause "API_KEY_HTTP_REFERRER_BLOCKED" errors,
      //    show an information toast (can't detect exact key block).
      console.log('Initial checks done');
    })();

    // ---------- Prevent accidental logout by cross origin popup blocking (helpful guidance) ----------
    window.addEventListener('error', function(ev){
      // keep console errors for debugging
      console.debug('Window error', ev);
    });

    // ---------- Small accessibility: allow enter key to open google (for keyboard users) ----------
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'g' && (e.ctrlKey || e.metaKey)) {
        // ctrl/cmd+g -> google login (developer convenience)
        document.getElementById('btnGoogle').click();
      }
    });

    // ---------- End of file ----------
  </script>
</body>
</html>
