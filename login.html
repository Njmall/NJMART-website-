<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NJ Mart — Admin Login</title>

  <!-- Minimal reset + friendly styles so the page looks consistent without external CSS -->
  <style>
    :root{
      --brand: #2ea34a;
      --brand-dark: #23883a;
      --muted: #6b7280;
      --bg: #f7faf7;
      --card: #ffffff;
      --danger: #e02424;
      --success: #1f8d4a;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#f7fff7 0%, #f0f6f0 100%);color:#111}
    .wrap{max-width:980px;margin:28px auto;padding:18px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:22px}
    .logo{
      width:56px;height:56px;border-radius:10px;background:var(--brand);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:20px;box-shadow:0 6px 18px rgba(34,139,34,0.12)
    }
    h1{margin:0;font-size:20px}
    .top-desc{color:var(--muted);font-size:14px;margin-top:6px}

    main{display:grid;grid-template-columns:1fr 420px;gap:24px}
    /* left column: large hero */
    .hero{
      background:linear-gradient(180deg,var(--brand) 0%, var(--brand-dark) 100%);
      color:white;padding:28px;border-radius:12px;min-height:320px;display:flex;flex-direction:column;justify-content:center;box-shadow:0 6px 30px rgba(28,107,36,0.14)
    }
    .hero h2{font-size:34px;margin:0 0 8px 0;line-height:1.05}
    .hero p{opacity:0.95;margin:0 0 14px 0}
    .hero .cta{display:flex;gap:10px;margin-top:12px}
    .btn{background:white;color:var(--brand);padding:10px 14px;border-radius:8px;font-weight:600;border:0;cursor:pointer}
    .btn-ghost{background:transparent;border:2px solid rgba(255,255,255,0.15);color:white;padding:8px 12px;border-radius:8px}
    .muted-small{color:rgba(255,255,255,0.85);font-size:13px}

    /* right column: login card */
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(18,18,18,0.06)}
    .card h3{margin:0 0 10px 0}
    .tabs{display:flex;gap:6px;margin-bottom:12px}
    .tab{flex:1;padding:8px;border-radius:8px;text-align:center;cursor:pointer;border:1px solid #e6eef0;background:#fafafa}
    .tab.active{background:linear-gradient(180deg,#f6fff6,#ffffff);border-color:var(--brand)}
    label{display:block;font-size:13px;margin:8px 0 6px 0;color:#213235}
    input[type="text"],input[type="email"],input[type="password"],input[type="tel"]{
      width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef0;background:#fff;
      box-sizing:border-box;font-size:14px;
    }
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    .small-muted{font-size:13px;color:var(--muted)}
    .hr{height:1px;background:#f1f5f4;margin:14px 0;border-radius:2px}
    .google-btn{display:flex;align-items:center;gap:10px;border-radius:8px;padding:8px;background:#fff;border:1px solid #e6eef0;cursor:pointer}
    .google-btn img{width:20px;height:20px}
    .msg{padding:8px;border-radius:8px;font-size:13px;margin-top:10px}
    .msg.info{background:#f0fdf4;color:var(--success);border:1px solid rgba(31,141,74,0.08)}
    .msg.error{background:#fff0f0;color:var(--danger);border:1px solid rgba(224,36,36,0.08)}
    .footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}

    /* responsive */
    @media (max-width:900px){
      main{grid-template-columns:1fr; padding-bottom:60px}
      .hero{order:2}
      .card{order:1}
    }

    /* tiny helper */
    .muted{color:var(--muted)}
    .link{color:var(--brand);cursor:pointer;text-decoration:underline}
    .fleft{float:left}
    .fright{float:right}
    .clear{clear:both}
    .small{font-size:12px;color:var(--muted)}
    .center{text-align:center}
  </style>

  <!-- ========= FIREBASE COMPAT SDKS (load before firebase-config below) =========
       Using compat build because it's easier to plug into classic code (auth, firestore, storage).
       If you want modular v9+ we can change; compat is simpler for this single-file drop-in.
  -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
  <!-- ======================================================================= -->
</head>
<body>
  <div class="wrap" id="app-root">
    <header>
      <div class="logo">NJ</div>
      <div>
        <h1>NJ Mart — Admin</h1>
        <div class="top-desc">Login to manage store, products, staff and orders.</div>
      </div>
    </header>

    <main>
      <!-- HERO / intro -->
      <section class="hero" aria-hidden="false">
        <h2>Fresh groceries delivered to your door</h2>
        <p class="muted-small">Admin portal. Use Google or Phone OTP to sign in quickly. Keep credentials safe.</p>
        <div class="cta">
          <button class="btn" id="go-dashboard" title="Open admin area (requires login)">Open admin (needs login)</button>
          <button class="btn-ghost" id="help">Help & Guide</button>
        </div>
        <div style="margin-top:18px" class="muted-small">Need to add product images? Use an external image host (postimages.org) and paste the URL in the admin product sheet.</div>
      </section>

      <!-- LOGIN CARD -->
      <section class="card" aria-label="login card">
        <h3>Sign in to your admin account</h3>

        <div style="display:flex;align-items:center;justify-content:space-between">
          <div class="small-muted">Use Google, Phone (OTP) or Email</div>
          <div id="auth-state" class="small-muted">Initializing...</div>
        </div>

        <div class="hr"></div>

        <div class="tabs" role="tablist">
          <div class="tab active" id="tab-google" role="tab">Google</div>
          <div class="tab" id="tab-phone" role="tab">Phone (OTP)</div>
          <div class="tab" id="tab-email" role="tab">Email</div>
        </div>

        <!-- Google sign-in -->
        <div id="panel-google" class="panel" role="tabpanel">
          <div class="google-btn" id="btn-google">
            <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 533.5 544.3'><path fill='%23ea4335' d='M533.5 278.4c0-18.2-1.6-36.2-4.8-53.6H272v101.3h146.9c-6.3 33.8-25.5 62.5-54.8 81.6l88.6 68.8c51.7-47.7 81.8-118 81.8-197.9z'/><path fill='%234285f4' d='M272 544.3c73.5 0 135.3-24.4 180.6-66.3l-88.6-68.8c-25 16.9-57 26.8-92 26.8-70.7 0-130.6-47.7-152-111.6L31.6 362.4C78.1 479.4 166.6 544.3 272 544.3z'/><path fill='%23fbbc05' d='M120 324.2c-10.6-31.2-10.6-64.9 0-96.1L31.6 162.4C-2.8 243.7-2.8 321 31.6 402.3l88.5-78.1z'/><path fill='%2325a75b' d='M272 106.1c38.6-.6 75.4 14.1 103.5 40.7l77.5-77.5C407.8 29 345.8 0 272 0 166.6 0 78.1 64.8 31.6 162.4l88.5 78.1C141.4 153.8 201.4 106.1 272 106.1z'/></svg>" alt="Google" />
            Continue with Google
          </div>
          <div class="small muted" style="margin-top:8px">Quick sign-in with Google (popup).</div>
        </div>

        <!-- Phone sign-in: OTP -->
        <div id="panel-phone" class="panel" style="display:none" role="tabpanel">
          <label for="phone-number">Phone number (with country code)</label>
          <input id="phone-number" type="tel" placeholder="+91xxxxxxxxxx" autocomplete="tel" />
          <!-- recaptcha container required by firebase phone -->
          <div id="recaptcha-container" style="margin-top:10px;"></div>

          <div style="margin-top:10px;display:flex;gap:8px">
            <button class="btn" id="phone-send">Send OTP</button>
            <button class="btn-ghost" id="phone-clear">Clear</button>
          </div>

          <div id="otp-panel" style="display:none;margin-top:10px">
            <label for="otp-code">Enter OTP</label>
            <input id="otp-code" type="text" placeholder="123456" />
            <div style="margin-top:8px;display:flex;gap:8px">
              <button class="btn" id="phone-verify">Verify OTP</button>
              <button class="btn-ghost" id="phone-resend">Resend</button>
            </div>
          </div>
        </div>

        <!-- Email sign-in -->
        <div id="panel-email" class="panel" style="display:none" role="tabpanel">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="admin@example.com" autocomplete="email" />
          <label for="password">Password</label>
          <input id="password" type="password" placeholder="Enter password" autocomplete="current-password" />

          <div style="margin-top:10px;display:flex;gap:8px">
            <button class="btn" id="email-login">Login</button>
            <button class="btn-ghost" id="email-signup">Sign up</button>
            <button class="btn-ghost" id="email-forgot">Forgot</button>
          </div>
        </div>

        <div id="status-box" class="msg info" style="display:none;margin-top:14px"></div>
        <div id="error-box" class="msg error" style="display:none;margin-top:14px"></div>

        <div class="footer">
          © NJ Mart — Admin portal. Support: <span id="support-number">+91 70000 00000</span>
        </div>
      </section>
    </main>
  </div>

  <!-- ========================= FIREBASE CONFIG (embedded) =========================
       This block contains the firebaseConfig from your project.
       If you rotate keys or change project settings, update values here.
  -->
  <script>
    // ---------------------------
    // PRODUCTION FIREBASE CONFIG
    // from the screenshots you provided (paste verified values here)
    // ---------------------------
    const NJ_FIREBASE_CONFIG = {
      apiKey: "AIzaSyCbf19k8pLfH-9UQz8sQRim2rPYT1qaEL8",
      authDomain: "njmartonline.firebaseapp.com",
      projectId: "njmartonline",
      storageBucket: "njmartonline.appspot.com",
      messagingSenderId: "594505763627",
      appId: "1:594505763627:web:a13b0d3ef40e620f9b936e"
    };

    // Backend Google Apps Script URL (your spreadsheet / backend)
    // (from the screenshot macro URL) — keep as-is or replace with your own endpoint
    const BACKEND_URL = "https://script.google.com/macros/s/AKfycbwsG5H7er3nqwGjEbrtokssc5LeGFc9Zog2bG1s0C5bQ-P2b_1S1kisSLpOmdESH7FB/exec";

    // Small helper to show messages on page
    function showStatus(msg) {
      const box = document.getElementById('status-box');
      box.style.display = 'block';
      box.className = 'msg info';
      box.textContent = msg;
      // auto hide after 8s
      setTimeout(()=>{ box.style.display='none'; }, 8000);
    }
    function showError(msg) {
      const box = document.getElementById('error-box');
      box.style.display = 'block';
      box.className = 'msg error';
      box.textContent = msg;
      // do not auto hide quickly
    }
  </script>

  <!-- initialize firebase app (depends on compat scripts above) -->
  <script>
    try {
      firebase.initializeApp(NJ_FIREBASE_CONFIG);
      console.log("[NJ_FIREBASE] Firebase initialized successfully");
    } catch (initErr) {
      console.error("[NJ_FIREBASE] init error:", initErr);
      showError("Firebase initialization error. Check console.");
    }

    // basic references
    const _auth = firebase.auth();
    const _db = firebase.firestore ? firebase.firestore() : null;
    const _storage = firebase.storage ? firebase.storage() : null;

    // update UI auth state text
    _auth.onAuthStateChanged(user => {
      const s = document.getElementById('auth-state');
      if (user) {
        s.textContent = `Signed in: ${user.displayName||user.phoneNumber||user.email || user.uid}`;
        console.log("User signed in", user);
        // optionally redirect to admin page:
        // window.location.href = '/admin.html';
      } else {
        s.textContent = "No user logged in";
        console.log("User logged out");
      }
    });
  </script>

  <!-- ========================= APP LOGIC (login handling) ========================= -->
  <script>
    // Safety: small DOM ready helper
    function $id(id){ return document.getElementById(id); }
    function qs(sel){ return document.querySelector(sel); }

    // Tabs behavior
    const tGoogle = $id('tab-google'), tPhone = $id('tab-phone'), tEmail = $id('tab-email');
    const pGoogle = $id('panel-google'), pPhone = $id('panel-phone'), pEmail = $id('panel-email');
    function setActiveTab(tab){
      [tGoogle,tPhone,tEmail].forEach(t=>t.classList.remove('active'));
      [pGoogle,pPhone,pEmail].forEach(p=>p.style.display='none');

      if(tab==='google'){ tGoogle.classList.add('active'); pGoogle.style.display='block'; }
      if(tab==='phone'){ tPhone.classList.add('active'); pPhone.style.display='block'; }
      if(tab==='email'){ tEmail.classList.add('active'); pEmail.style.display='block'; }
    }
    tGoogle.addEventListener('click', ()=>setActiveTab('google'));
    tPhone.addEventListener('click', ()=>setActiveTab('phone'));
    tEmail.addEventListener('click', ()=>setActiveTab('email'));

    // Google sign-in
    const btnGoogle = $id('btn-google');
    btnGoogle.addEventListener('click', async function(){
      try {
        showStatus("Opening Google sign-in...");
        const provider = new firebase.auth.GoogleAuthProvider();
        // optional: force prompt
        provider.setCustomParameters({ prompt: 'select_account' });
        const result = await _auth.signInWithPopup(provider);
        console.log("Google sign-in success", result);
        showStatus("Signed in with Google: " + (result.user.displayName || result.user.email));
        // Call backend if needed:
        // await fetch(BACKEND_URL + "?action=session&uid=" + result.user.uid);
      } catch(err){
        console.error("Google sign-in error", err);
        showError("Google sign-in failed: " + (err.message||err));
      }
    });

    // PHONE AUTH flow
    let recaptchaVerifier = null;
    let confirmationResult = null;

    // init reCAPTCHA (render) - run once
    function initRecaptcha(){
      if(recaptchaVerifier) return recaptchaVerifier;
      // invisible reCAPTCHA (Firebase requires container)
      recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
        'size': 'invisible', // 'normal' to see widget or 'invisible'
        'callback': function(response) {
          // reCAPTCHA solved - will proceed with submitPhoneNumberAuth()
          console.log("reCAPTCHA solved");
        },
        'expired-callback': function(){
          console.warn("reCAPTCHA expired; user needs to re-verify");
        }
      });
      recaptchaVerifier.render().then(widgetId => {
        console.log("reCAPTCHA widget ready", widgetId);
      }).catch(err=>{
        console.warn("reCAPTCHA render issue:", err);
      });
      return recaptchaVerifier;
    }

    $id('phone-send').addEventListener('click', async function(){
      const phone = $id('phone-number').value.trim();
      if(!phone){ showError("Enter a phone number including country code (e.g. +91...)"); return; }
      try {
        showStatus("Sending OTP to " + phone);
        initRecaptcha();
        confirmationResult = await _auth.signInWithPhoneNumber(phone, recaptchaVerifier);
        console.log("OTP sent", confirmationResult);
        showStatus("OTP sent. Enter it below.");
        $id('otp-panel').style.display = 'block';
      } catch(err){
        console.error("Phone send error", err);
        if(err.code) showError("Phone OTP error: " + err.code + " - " + err.message);
        else showError("Phone OTP error: " + (err.message || err));
      }
    });

    $id('phone-verify').addEventListener('click', async function(){
      const code = $id('otp-code').value.trim();
      if(!code){ showError("Enter the OTP"); return; }
      try {
        showStatus("Verifying OTP...");
        const result = await confirmationResult.confirm(code);
        console.log("Phone sign-in success", result.user);
        showStatus("Phone verified: " + (result.user.phoneNumber || result.user.uid));
      } catch(err){
        console.error("OTP verify error", err);
        showError("OTP verification failed: " + (err.message || err));
      }
    });

    $id('phone-resend').addEventListener('click', function(){
      // re-send: reset recaptcha and call send again
      try {
        if(recaptchaVerifier) recaptchaVerifier.clear();
      } catch(e){}
      initRecaptcha();
      $id('phone-send').click();
    });
    $id('phone-clear').addEventListener('click', function(){
      $id('phone-number').value = '';
      $id('otp-code').value = '';
      $id('otp-panel').style.display = 'none';
      try{ if(recaptchaVerifier) recaptchaVerifier.clear(); }catch(e){}
    });

    // EMAIL auth
    $id('email-login').addEventListener('click', async function(){
      const em = $id('email').value.trim(), pw = $id('password').value;
      if(!em || !pw){ showError("Enter email and password"); return; }
      try {
        showStatus("Signing in...");
        const r = await _auth.signInWithEmailAndPassword(em, pw);
        console.log("Email login ok", r.user);
        showStatus("Signed in: " + (r.user.email || r.user.uid));
      } catch(err){
        console.error("Email login error", err);
        showError("Email login failed: " + (err.message || err.code || err));
      }
    });
    $id('email-signup').addEventListener('click', async function(){
      const em = $id('email').value.trim(), pw = $id('password').value;
      if(!em || !pw){ showError("Enter email and password to sign up"); return; }
      try {
        showStatus("Creating account...");
        const r = await _auth.createUserWithEmailAndPassword(em, pw);
        console.log("Account created", r.user);
        showStatus("Account created — signed in as " + (r.user.email || r.user.uid));
      } catch(err){
        console.error("Signup error", err);
        showError("Signup failed: " + (err.message || err.code || err));
      }
    });
    $id('email-forgot').addEventListener('click', async function(){
      const em = $id('email').value.trim();
      if(!em){ showError("Enter your email to reset password"); return; }
      try {
        await _auth.sendPasswordResetEmail(em);
        showStatus("Password reset email sent to " + em);
      } catch(err){
        console.error("Reset error", err);
        showError("Reset email failed: " + (err.message || err));
      }
    });

    // helper to allow "Open admin" button which should check auth
    $id('go-dashboard').addEventListener('click', function(){
      const user = _auth.currentUser;
      if(user){
        showStatus("Already signed in: " + (user.displayName || user.email || user.phoneNumber || user.uid));
        // redirect to admin dashboard
        // window.location.href = '/admin.html';
      } else {
        showError("You must sign in first. Use Google or Phone OTP or Email.");
      }
    });

    // small onload init
    window.addEventListener('load', function(){
      // render recaptcha (invisible) but only when phone tab used; pre-initialize to avoid timing issues
      try { initRecaptcha(); } catch(e){ console.warn("Recaptcha init failed", e); }

      // default tab set
      setActiveTab('google');

      // show which backend is configured (optional)
      console.log("[NJ_API] script-config loaded. BACKEND_URL=", BACKEND_URL);
      const sbox = $id('status-box');
      sbox.style.display = 'none';
      const ebox = $id('error-box');
      ebox.style.display = 'none';
      document.getElementById('support-number').textContent = "+91 70000 00000"; // replace with real support
      document.getElementById('recaptcha-container').style.minHeight = '18px';
      // small message
      console.log("NJ Mart login page initialized. BACKEND URL:", BACKEND_URL);
    });

    // Expose some helpers to console for debugging
    window.__NJ = {
      auth: _auth,
      config: NJ_FIREBASE_CONFIG,
      backend: BACKEND_URL
    };

  </script>

  <!-- ========================= END OF FILE ========================= -->
</body>
</html>
