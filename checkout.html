<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NJ Mart — Checkout</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--green:#2db34a;--muted:#7b7f86;--card:#fff;--bg:#f3faf6}
  *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,sans-serif}
  body{margin:0;background:var(--bg);color:#111}
  .page{max-width:960px;margin:20px auto;padding:14px}
  .card{background:var(--card);border-radius:12px;box-shadow:0 8px 24px rgba(12,30,40,.06);padding:14px;margin-bottom:14px}
  .row{display:flex;gap:12px}
  @media(max-width:900px){ .row{flex-direction:column} }
  .col{flex:1}
  .small{color:var(--muted);font-size:13px}
  .item{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f2f4f5}
  .total{font-weight:700;font-size:18px}
  .btn{border:0;border-radius:10px;padding:12px;font-weight:700;cursor:pointer}
  .btn.primary{background:var(--green);color:#fff;width:100%}
  .btn.ghost{background:#fff;border:1px solid #e6eaec;color:#333;width:100%}
</style>
</head>
<body>
  <div class="page">
    <div class="card">
      <h1>Checkout</h1>
      <div class="small">Review order, select delivery address and place your order</div>
    </div>

    <div class="row">
      <div class="col">
        <div class="card">
          <h3>Delivery address</h3>
          <div id="addrBlock" style="margin-top:8px"></div>
          <div style="margin-top:10px;display:flex;gap:8px">
            <button id="editProfile" class="btn ghost">Edit Profile</button>
            <button id="useOther" class="btn ghost">Use different address</button>
          </div>
        </div>

        <div class="card">
          <h3>Items</h3>
          <div id="itemsList" style="margin-top:8px"></div>
        </div>
      </div>

      <aside style="width:320px">
        <div class="card">
          <h3>Order summary</h3>
          <div id="summaryBox" style="margin-top:8px"></div>
          <div style="margin-top:12px">
            <button id="placeOrder" class="btn primary">Place Order</button>
          </div>
          <div style="margin-top:10px" class="small">Orders in this demo are saved locally (browser).</div>
        </div>
      </aside>
    </div>
  </div>

<script>
  // checkout.js (localStorage-based)
  const DELIVERY_THRESHOLD = 499;
  const DELIVERY_CHARGE = 25;

  function loadCart(){ try{ return JSON.parse(localStorage.getItem('nj_cart')||'[]'); }catch(e){ return []; } }
  function saveOrders(o){ const arr = JSON.parse(localStorage.getItem('nj_orders')||'[]'); arr.unshift(o); localStorage.setItem('nj_orders', JSON.stringify(arr)); }

  function renderItems(){
    const cart = loadCart();
    const el = document.getElementById('itemsList');
    if(cart.length===0){ el.innerHTML = '<div class="small">Your cart is empty.</div>'; return; }
    el.innerHTML = '';
    cart.forEach(i=>{
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `<div><div style="font-weight:700">${i.name}</div><div class="small">Qty: ${i.qty}</div></div><div style="text-align:right"><div style="font-weight:700">₹${(i.price*i.qty).toFixed(0)}</div></div>`;
      el.appendChild(div);
    });
  }

  function getProfile(){ try{ return JSON.parse(localStorage.getItem('nj_profile')||'{}'); }catch(e){ return {}; } }
  function renderAddress(){
    const p = getProfile();
    const el = document.getElementById('addrBlock');
    if(!p || (!p.name && !p.address)){
      el.innerHTML = `<div class="small">No profile address saved. <a id="goProfile" class="link">Save profile</a></div>`;
      document.getElementById('goProfile').addEventListener('click', ()=> location.href='profile.html');
      return;
    }
    el.innerHTML = `<div><strong>${p.name||'—'}</strong></div>
      <div class="small" style="margin-top:6px">Phone: ${p.phone||'—'}</div>
      <div style="margin-top:8px">${(p.address||'—').replace(/\n/g,'<br>')}</div>`;
  }

  function renderSummary(){
    const cart = loadCart();
    const subtotal = cart.reduce((s,i)=>s + i.price*i.qty, 0);
    const delivery = subtotal >= DELIVERY_THRESHOLD || subtotal===0 ? 0 : DELIVERY_CHARGE;
    const grand = subtotal + delivery;
    const box = document.getElementById('summaryBox');
    box.innerHTML = `
      <div class="small">Items total</div><div style="text-align:right;font-weight:700">₹${subtotal.toFixed(0)}</div>
      <div style="height:8px"></div>
      <div class="small">Delivery</div><div style="text-align:right">₹${delivery.toFixed(0)}</div>
      <hr style="margin:12px 0;border:none;border-top:1px solid #f1f3f4">
      <div style="display:flex;justify-content:space-between" class="total"><div>Grand total</div><div>₹${grand.toFixed(0)}</div></div>
    `;
  }

  document.getElementById('editProfile').addEventListener('click', ()=> location.href='profile.html');
  document.getElementById('useOther').addEventListener('click', ()=>{
    const other = prompt('Enter alternative address (will not be saved):');
    if(other){ document.getElementById('addrBlock').innerHTML = `<div style="white-space:pre-wrap">${other}</div>`; }
  });

  document.getElementById('placeOrder').addEventListener('click', ()=>{
    const cart = loadCart();
    if(cart.length===0){ alert('Cart empty'); return; }
    const profile = getProfile();
    if(!profile || !profile.name || !profile.address){ if(!confirm('No profile saved. Continue with checkout?')) return; }
    const subtotal = cart.reduce((s,i)=>s + i.price*i.qty, 0);
    const delivery = subtotal >= DELIVERY_THRESHOLD ? 0 : DELIVERY_CHARGE;
    const order = {
      id: 'ORD' + Date.now(),
      items: cart,
      subtotal,
      delivery,
      total: subtotal + delivery,
      profile: profile,
      createdAt: Date.now(),
      status: 'placed'
    };
    saveOrders(order);
    // clear cart and checkout info
    localStorage.removeItem('nj_cart');
    localStorage.setItem('nj_last_order', JSON.stringify(order));
    alert('Order placed — ID: ' + order.id);
    location.href = 'orders.html';
  });

  // init
  renderItems();
  renderAddress();
  renderSummary();
</script>
</body>
</html>
